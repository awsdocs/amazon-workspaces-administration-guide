# Troubleshooting Amazon WorkSpaces Issues<a name="amazon-workspaces-troubleshooting"></a>

The following information can help you troubleshoot issues with your WorkSpaces\.

## Enabling Advanced Logging<a name="advanced-logging"></a>

To help troubleshoot issues that your users may experience, you can enable advanced logging on any Amazon WorkSpaces client\. Advanced logging is enabled for every subsequent client session until you disable it\.

Advanced logging generates log files that contain diagnostic information and debugging\-level details, including verbose performance data\. These files are automatically uploaded to a database in AWS\. 

**Note**  
To have AWS review the log files that are generated by advanced logging and to receive technical support for issues with your WorkSpaces clients, contact AWS Support\. For more information, see [AWS Support Center](https://console.aws.amazon.com/support/home#/)\.

### To enable advanced logging for 3\.0\+ clients<a name="logging-new-clients"></a>

**Topics**

The Windows client logs are stored in the following location\.

`%LOCALAPPDATA%\Amazon Web Services\Amazon WorkSpaces\logs`

**To enable advanced logging for Windows clients**

1. Close the Amazon WorkSpaces client\.

1. Open the Command Prompt app\.

1. Launch the WorkSpaces client with the `-l3` flag\.

   `c:`

   `cd "C:\Program Files (x86)\Amazon Web Services, Inc\Amazon WorkSpaces"`

   `workspaces.exe -l3`

**Topics**

The macOS client logs are stored in the following location\.

`~/Library/"Application Support"/"Amazon Web Services"/"Amazon WorkSpaces"/logs`

**To enable advanced logging for macOS clients**

1. Close the Amazon WorkSpaces client\.

1. Open Terminal\.

1. Run the following command\.

   `open -a workspaces --args -l3`

**Topics**

The Linux client logs are stored in the following location\.

`~/.local/share/Amazon Web Services/Amazon WorkSpaces/logs`

**To enable advanced logging for Linux clients**

1. Close the Amazon WorkSpaces client\.

1. Open Terminal\.

1. Run the following command\.

   `/opt/workspacesclient/workspacesclient -l3`

### To enable advanced logging for 1\.0\+ and 2\.0\+ clients<a name="logging-legacy-clients"></a>

1. Open the WorkSpaces client\.

1. Choose the gear icon in the upper\-right corner of the client application\.

1. Choose **Advanced Settings**\.

1. Select the **Enable Advanced Logging** check box\.

1. Choose **Save**\.

## Troubleshooting for Specific Issues<a name="troubleshooting-specific-issues"></a>

The following information can help you troubleshoot specific issues with your WorkSpaces\.

**Topics**
+ [I can't create an Amazon Linux WorkSpace because there are non\-valid characters in the user name](#linux_workspace_provision_fail_username)
+ [I changed the shell for my Amazon Linux WorkSpace and now I can't provision a PCoIP session](#linux_workspace_provision_fail_shell_override)
+ [Launching WorkSpaces in my connected directory often fails](#provision_fail)
+ [Launching WorkSpaces fails with an internal error](#launch-failure-ipv6)
+ [My users can't connect to a Windows WorkSpace with an interactive logon banner](#logon_banner)
+ [My users can't connect to a Windows WorkSpace](#gpo_security_user_rights)
+ [My users are having issues when they try to log on to BYOL WorkSpaces from WorkSpaces Web Access](#byol_logon_issues)
+ [The WorkSpaces client gives my users a network error, but they are able to use other network\-enabled apps on their devices](#network_error)
+ [My WorkSpace users see the following error message: "Device can't connect to the registration service\. Check your network settings\."](#registration_service_failure)
+ [My PCoIP zero client users are receiving the error "The supplied certificate is invalid due to timestamp"](#pcoip_zero_client_ntp)
+ [My users aren’t receiving invitation emails or password reset emails](#welcome_emails)
+ [I receive the message "The system administrator has set policies to prevent this installation" when I try to install applications on a Windows WorkSpace](#msi_wont_install)
+ [No WorkSpaces in my directory can connect to the internet](#no_internet)
+ [I receive a "DNS unavailable" error when I try to connect to my on\-premises directory](#dns_unavailable)
+ [I receive a "Connectivity issues detected" error when I try to connect to my on\-premises directory](#connectivity_issues_detected)
+ [I receive an "SRV record" error when I try to connect to my on\-premises directory](#srv_record_not_found)
+ [My Windows WorkSpace goes to sleep when it's left idle](#windows_workspace_sleeps_when_idle)
+ [One of my WorkSpaces has a state of "Unhealthy"](#unhealthy)
+ [I receive ThrottlingException errors to some of my API calls](#throttled-api-calls)

### I can't create an Amazon Linux WorkSpace because there are non\-valid characters in the user name<a name="linux_workspace_provision_fail_username"></a>

For Amazon Linux WorkSpaces, user names can contain only up to 20 letters, spaces, and numbers that are representable in UTF\-8, plus the following special characters:

 \_\.\-\#

Additionally, you can't use a dash symbol \(\-\) as the first character of the user name\.

**Note**  
These limitations do not apply to Windows WorkSpaces\. Windows WorkSpaces support the @ and \- symbols for all characters in the user name\.

### I changed the shell for my Amazon Linux WorkSpace and now I can't provision a PCoIP session<a name="linux_workspace_provision_fail_shell_override"></a>

To override the default shell for Linux WorkSpaces, see [Override the Default Shell for Amazon Linux WorkSpaces](manage_linux_workspace.md#linux_shell)\. 

### Launching WorkSpaces in my connected directory often fails<a name="provision_fail"></a>

Verify that the two DNS servers or domain controllers in your on\-premises directory are accessible from each of the subnets that you specified when you connected to your directory\. You can verify this connectivity by launching an EC2 instance in each subnet and joining the instance to your directory, using the IP addresses of the two DNS servers\.

### Launching WorkSpaces fails with an internal error<a name="launch-failure-ipv6"></a>

Check whether your subnets are configured to automatically assign IPv6 addresses to instances launched in the subnet\. To check this setting, open the Amazon VPC console, select your subnet, and choose **Subnet Actions**, **Modify auto\-assign IP settings**\. If this setting is enabled, you cannot launch WorkSpaces using the Performance or Graphics bundles\. Instead, disable this setting and specify IPv6 addresses manually when you launch your instances\.

### My users can't connect to a Windows WorkSpace with an interactive logon banner<a name="logon_banner"></a>

If an interactive logon message has been implemented to display a logon banner, this prevents users from being able to access their Windows WorkSpaces\. The interactive logon message Group Policy setting is not currently supported by Amazon WorkSpaces\.

### My users can't connect to a Windows WorkSpace<a name="gpo_security_user_rights"></a>

My users receive the following error when they try to connect to their Windows WorkSpaces:

```
"An error occurred while launching your WorkSpace. Please try again."
```

If the following group policy is incorrectly configured, it prevents users from being able to access their Windows WorkSpaces:

**Computer Configuration\\Windows Settings\\Security Settings\\Local Policies\\User Rights Assignment**
+ **Incorrect policy:**

  Policy: **Access this computer from the network**

  Setting: *Domain name*\\Domain Computers

  Winning GPO: Allow File Access
+ **Correct policy:**

  Policy: **Access this computer from the network**

  Setting: *Domain name*\\Domain Users

  Winning GPO: Allow File Access

**Note**  
This policy setting should be applied to **Domain Users** instead of **Domain Computers**\.

For more information, see [ Access this computer from the network \- security policy setting](https://docs.microsoft.com/windows/security/threat-protection/security-policy-settings/access-this-computer-from-the-network) and [ Configure security policy settings](https://docs.microsoft.com/windows/security/threat-protection/security-policy-settings/how-to-configure-security-policy-settings) in the Microsoft Windows documentation\.

### My users are having issues when they try to log on to BYOL WorkSpaces from WorkSpaces Web Access<a name="byol_logon_issues"></a>

BYOL WorkSpaces rely on a specific logon screen configuration to enable users to successfully log on from their Web Access client\. To enable Web Access users to log on to their BYOL WorkSpaces, you must configure a Group Policy setting and a Local Security Policy setting\. If these two settings are not correctly configured, users may experience long logon times or black screens when they try to log on to their BYOL WorkSpaces\. To configure the settings, follow these steps\. 

**To enable the WorkSpaces logon agent to switch users**

In most cases, when a user attempts to log on to a WorkSpace, the user name field is prepopulated with the name of that user\. However, if an administrator establishes an RDP connection to the WorkSpace to perform maintenance tasks, the user name field is populated with the name of the administrator instead\. To resolve this issue, disable the **Hide entry points for Fast User Switching** Group Policy setting\. When you do so, the WorkSpaces logon agent can use the **Switch User** button to populate the user name field with the correct name\.

1. Open Local Group Policy Editor by opening the command prompt as an administrator, entering `gpedit.msc`, and then pressing **Enter**\. 

1. In the console tree, choose **Local Computer Policy**, **Computer Configuration**, **Administrative Templates**, **System**, and **Logon**\.

1. Open the **Hide entry points for Fast User Switching** setting\.

1. In the **Hide entry points for Fast User Switching** dialog box, choose **Disabled**, and then choose **OK**\.

**To configure Local Security Policy Editor to hide the last logged on user name**

By default, the list of last logged on users displays, rather than the **Switch User** button\. Depending on the configuration of the WorkSpace, the list may not display the **Other User** tile\. When this occurs, if the prepopulated user name isn't correct, the WorkSpaces logon agent can't populate the field with the correct name\. To resolve this issue, enable the **Interactive logon: Don't display last signed\-in** Local Security Policy setting\.

1. Open Local Security Policy Editor by opening the command prompt as an administrator, entering `secpol.msc`, and then pressing **Enter**\. 

1. In the console tree, choose **Security Settings**, **Local Policies**, and **Security Options**\.

1. Open one of the following settings:
   + For Windows 7 — **Interactive logon: Do not display last user name**
   + For Windows 10 — **Interactive logon: Don't display last signed\-in**

1. In the **Properties** dialog box for the setting, choose **Enabled**, and then choose **OK**\.

### The WorkSpaces client gives my users a network error, but they are able to use other network\-enabled apps on their devices<a name="network_error"></a>

The WorkSpaces client applications rely on access to resources in the AWS Cloud, and require a connection that provides at least 1 Mbps download bandwidth\. If a device has an intermittent connection to the network, the WorkSpaces client application might report an issue with the network\.

Amazon WorkSpaces enforces the use of digital certificates issued by Amazon Trust Services, as of May 2018\. Amazon Trust Services is already a trusted Root CA on the operating systems that are supported by Amazon WorkSpaces\. If the Root CA list for the operating system is not up to date, the device cannot connect to WorkSpaces and the client gives a network error\.

**To recognize connection issues due to certificate failures**
+ PCoIP zero clients — The following error message is displayed\.

  ```
  Failed to connect. The server provided a certificate that is invalid. See below for details:
  - The supplied certificate is invalid due to timestamp
  - The supplied certificate is not rooted in the devices local certificate store
  ```
+ Other clients — The health checks fail with a red warning triangle for **Internet**\.

**Topics**
+ [Windows Client Application](#certificate-issues-windows)
+ [PCoIP Zero Clients](#certificate-issues-zero-clients)
+ [Other Client Applications](#certificate-issues-other)

#### Windows Client Application<a name="certificate-issues-windows"></a>

Use one of the following solutions for certificate failures\.

**Solution 1: Update the client application**  
Download and install the latest Windows client application from [Amazon WorkSpaces Client Downloads](https://clients.amazonworkspaces.com/)\. During installation, the client application ensures that your operating system trusts certificates issued by Amazon Trust Services\.

**Solution 2: Add Amazon Trust Services to the local Root CA list**

1. Open [https://www\.amazontrust\.com/repository/](https://www.amazontrust.com/repository/)\.

1. Download the Starfield certificate in DER format \(2b071c59a0a0ae76b0eadb2bad23bad4580b69c3601b630c2eaf0613afa83f92\)\.

1. Open the Microsoft Management Console\. \(From a Command Prompt window, run mmc\.\)

1. Choose **File**, **Add/Remove Snap\-in**, **Certificates**, **Add**\.

1. On the **Certificates snap\-in** page, select **Computer account** and choose **Next**\. Keep the default, **Local computer**\. Choose **Finish**\. Choose **OK**\.

1. Expand **Certificates \(Local Computer\)** and select **Trusted Root Certification Authorities**\. Choose **Action**, **All Tasks**, **Import**\.

1. Follow the wizard to import the certificate that you downloaded\.

1. Exit and restart the WorkSpaces client application\.

**Solution 3: Deploy Amazon Trust Services as a trusted CA using Group Policy**  
Add the Starfield certificate to the trusted Root CAs for the domain using Group Policy\. For more information, see [Use Policy to Distribute Certificates](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc772491(v=ws.11))\.

#### PCoIP Zero Clients<a name="certificate-issues-zero-clients"></a>

To connect directly to a WorkSpace using firmware version 6\.0 or later, download and install the certificate issued by Amazon Trust Services\.

**To add Amazon Trust Services as a trusted Root CA**

1. Open [https://certs\.secureserver\.net/repository/](https://certs.secureserver.net/repository/)\.

1. Download the certificate under **Starfield Certificate Chain** with the thumbprint 14 65 FA 20 53 97 B8 76 FA A6 F0 A9 95 8E 55 90 E4 0F CC 7F AA 4F B7 C2 C8 67 75 21 FB 5F B6 58\.

1. Upload the certificate to the zero client\. For more information, see [Uploading Certificates](https://www.teradici.com/web-help/TER1504003/6.0/default.htm#05_Managing/04_UploadCertificate.htm) in the Teradici documentation\.

#### Other Client Applications<a name="certificate-issues-other"></a>

Add the Starfield certificate \(2b071c59a0a0ae76b0eadb2bad23bad4580b69c3601b630c2eaf0613afa83f92\) from [Amazon Trust Services](https://www.amazontrust.com/repository/)\. For more information about how to add a Root CA, see the following documentation:
+ Android: [Add & remove certificates](https://support.google.com/nexus/answer/2844832)
+ Chrome OS: [Manage client certificates on Chrome devices](https://support.google.com/chrome/a/answer/6080885)
+ macOS and iOS: [Installing a CA's Root Certificate on Your Test Device](https://developer.apple.com/library/content/qa/qa1948/_index.html#//apple_ref/doc/uid/DTS40017603-CH1-SECINSTALLING)

### My WorkSpace users see the following error message: "Device can't connect to the registration service\. Check your network settings\."<a name="registration_service_failure"></a>

When a registration service failure occurs, your WorkSpace users might see the following error message on the **Connection Health Check** page: "Your device is not able to connect to the WorkSpaces Registration service\. You will not be able to register your device with WorkSpaces\. Please check your network settings\."

This error occurs when the WorkSpaces client application can't reach the registration service\. Typically, this happens when the WorkSpaces directory has been deleted\. To resolve this error, make sure that the registration code is valid and corresponds to a running directory in the AWS Cloud\.

### My PCoIP zero client users are receiving the error "The supplied certificate is invalid due to timestamp"<a name="pcoip_zero_client_ntp"></a>

If Network Time Protocol \(NTP\) isn't enabled in Teradici, your PCoIP zero client users might receive certificate failure errors\. To set up NTP, see [Set Up PCoIP Zero Client for WorkSpaces](set-up-pcoip-zero-client.md)\.

### My users aren’t receiving invitation emails or password reset emails<a name="welcome_emails"></a>

Users might not receive welcome or password reset emails for WorkSpaces that were created using AD Connector\.

To manually send welcome emails to these users, see [Send an Invitation Email](manage-workspaces-users.md#send-invitation)\.

To assist users with resetting their passwords, see your documentation for Microsoft Active Directory\.

### I receive the message "The system administrator has set policies to prevent this installation" when I try to install applications on a Windows WorkSpace<a name="msi_wont_install"></a>

You can address this issue by modifying the Windows Installer Group Policy setting\. To deploy this policy to multiple WorkSpaces in your directory, apply this setting to a Group Policy object that is linked to the WorkSpaces organizational unit \(OU\) from a domain\-joined EC2 instance\. If you are using AD Connector, you can make these changes from a domain controller\. For more information about using the Active Directory administration tools to work with Group Policy objects, see [Installing the Active Directory Administration Tools](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms_ad_install_ad_tools.html) in the *AWS Directory Service Administration Guide*\.

The following procedure shows how to configure the Windows Installer setting for the Amazon WorkSpaces Group Policy object\.

1. Make sure that the most recent [Amazon WorkSpaces Group Policy administrative template](group_policy.md#gp_install_template) is installed in your domain\.

1. Open the Group Policy Management tool on your Windows WorkSpace client and navigate to and select the WorkSpaces Group Policy object for your WorkSpaces machine accounts\. Choose **Action**, **Edit** in the main menu\.

1. In the Group Policy Management Editor, choose **Computer Configuration**, **Policies**, **Administrative Templates**, **Classic Administrative Templates**, **Windows Components**, **Windows Installer**\.

1. Open the **Turn Off Windows Installer** setting\.

1. In the **Turn Off Windows Installer** dialog box, change **Not Configured** to **Enabled**, and then set **Disable Windows Installer** to **Never**\.

1. Choose **OK**\.

1. To apply the group policy changes, do one of the following:
   + Reboot the WorkSpace \(in the Amazon WorkSpaces console, select the WorkSpace, then choose **Actions**, **Reboot WorkSpaces**\)\.
   + From an administrative command prompt, enter gpupdate /force\.

### No WorkSpaces in my directory can connect to the internet<a name="no_internet"></a>

WorkSpaces cannot communicate with the internet by default\. You must explicitly provide internet access\. For more information, see [Provide Internet Access from Your WorkSpace](amazon-workspaces-internet-access.md)\.

### I receive a "DNS unavailable" error when I try to connect to my on\-premises directory<a name="dns_unavailable"></a>

You receive an error message similar to the following when connecting to your on\-premises directory\.

```
DNS unavailable (TCP port 53) for IP: dns-ip-address
```

AD Connector must be able to communicate with your on\-premises DNS servers via TCP and UDP over port 53\. Verify that your security groups and on\-premises firewalls allow TCP and UDP communication over this port\.

### I receive a "Connectivity issues detected" error when I try to connect to my on\-premises directory<a name="connectivity_issues_detected"></a>

You receive an error message similar to the following when connecting to your on\-premises directory\.

```
Connectivity issues detected: LDAP unavailable (TCP port 389) for IP: ip-address
Kerberos/authentication unavailable (TCP port 88) for IP: ip-address
Please ensure that the listed ports are available and retry the operation.
```

AD Connector must be able to communicate with your on\-premises domain controllers via TCP and UDP over the following ports\. Verify that your security groups and on\-premises firewalls allow TCP and UDP communication over these ports\.
+ 88 \(Kerberos\)
+ 389 \(LDAP\)

### I receive an "SRV record" error when I try to connect to my on\-premises directory<a name="srv_record_not_found"></a>

You receive an error message similar to one or more of the following when connecting to your on\-premises directory\.

```
SRV record for LDAP does not exist for IP: dns-ip-address

SRV record for Kerberos does not exist for IP: dns-ip-address
```

AD Connector needs to obtain the `_ldap._tcp.dns-domain-name` and `_kerberos._tcp.dns-domain-name` SRV records when connecting to your directory\. You get this error if the service cannot obtain these records from the DNS servers that you specified when connecting to your directory\. Make sure that your DNS servers contain these SRV records\. For more information, see [SRV Resource Records](https://technet.microsoft.com/en-us/library/cc961719.aspx) on Microsoft TechNet\.

### My Windows WorkSpace goes to sleep when it's left idle<a name="windows_workspace_sleeps_when_idle"></a>

To resolve this issue, connect to the WorkSpace and change the power plan to **High performance** by using the following procedure:

1. From the WorkSpace, open **Control Panel**, then choose **Hardware and Sound**\.

1. Under **Power Options**, choose **Choose a power plan**\. 

1. In the **Choose or customize a power plan** pane, choose the **High performance** power plan\. If this plan isn't visible, choose the arrow to the right of **Show additional plans** to display it\. 

If the preceding steps do not solve the issue, do the following: 

1. In the **Choose or customize a power plan** pane, choose the **Change plan settings** link to the right of the **High performance** power plan, then choose the **Change advanced power settings** link\.

1. In the **Power Options** dialog box, in the list of settings, choose the plus sign to the left of **Hard disk** to display the relevant settings\. 

1. Verify that the **Turn off hard disk after** value for **Plugged in** is greater than the value for **On battery** \(the default value is 20 minutes\)\.

1. Choose the plus sign to the left of **PCI Express**, and do the same for **Link State Power Management**\.

1. Verify that the **Link State Power Management** settings are **Off**\.

1. Choose **OK** \(or **Apply** if you changed any settings\) to close the dialog box\.

1. In the **Change settings for the plan** pane, if you changed any settings, choose **Save changes**\.

### One of my WorkSpaces has a state of "Unhealthy"<a name="unhealthy"></a>

The Amazon WorkSpaces service periodically sends status requests to a WorkSpace\. A WorkSpace is marked `Unhealthy` when it fails to respond to these requests\. Common causes for this problem are:
+ An application on the WorkSpace is blocking network ports, which prevents the WorkSpace from responding to the status request\.
+ High CPU utilization is preventing the WorkSpace from responding to the status request in a timely manner\.
+ The computer name of the WorkSpace has been changed\. This prevents a secure channel from being established between Amazon WorkSpaces and the WorkSpace\.

You can attempt to correct the situation using the following methods:
+ Reboot the WorkSpace from the Amazon WorkSpaces console\.
+ Connect to the unhealthy WorkSpace using the following procedure, which should be used only for troubleshooting purposes:

  1. Connect to an operational WorkSpace in the same directory as the unhealthy WorkSpace\.

  1. From the operational WorkSpace, use Remote Desktop Protocol \(RDP\) to connect to the unhealthy WorkSpace using the IP address of the unhealthy WorkSpace\. Depending on the extent of the problem, you might not be able to connect to the unhealthy WorkSpace\.

  1. On the unhealthy WorkSpace, confirm that the minimum port requirements are met\.
+ Rebuild the WorkSpace from the Amazon WorkSpaces console\. Because rebuilding a WorkSpace can potentially cause a loss of data, this option should only be used if all other attempts to correct the problem have been unsuccessful\.

### I receive ThrottlingException errors to some of my API calls<a name="throttled-api-calls"></a>

The default allowed rate for Amazon WorkSpaces API calls is a constant rate of two API calls per second, with a maximum allowed "burst" rate of five API calls per second\. The following table shows how the burst rate limit works for API requests\.


| Second | Number of Requests Sent | Net Requests Allowed | Details | 
| --- | --- | --- | --- | 
|  1  |  0  |  5  |  During the first second \(second 1\), five requests are allowed, up to the burst rate maximum of five calls per second\.  | 
|  2  |  2  |  5  |  Because two or fewer calls were issued in second 1, the full burst capacity of five calls is still available\.  | 
|  3  |  5  |  5  |  Because only two calls were issued in second 2, the full burst capacity of five calls is still available\.  | 
|  4  |  2  |  2  |  Because the full burst capacity was used in second 3, only the constant rate of two calls per second is available\.  | 
|  5  |  3  |  2  |  Because there is no remaining burst capacity, only two calls are allowed at this time\. This means that one of the three API calls is throttled\. The one throttled call will respond after a short delay\.  | 
|  6  |  0  |  1  |  Because one of the calls from second 5 is being retried in second 6, there is capacity for only one additional call in second 6 because of the constant rate limit of two calls per second\.  | 
|  7  |  0  |  3  |  Now that there are no longer throttled API calls in the queue, the rate limit will continue to increase, up to the burst rate limit of five calls\.  | 
|  8  |  0  |  5  |  Because no calls were issued in second 7, the maximum number of requests is allowed\.  | 
|  9  |  0  |  5  |  Even though no calls were issued in second 8, the rate limit does not increase above five\.  | 